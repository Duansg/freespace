---
// Component Imports
import BaseHead from '../../components/BaseHead.astro';
import Nav from '../../components/widget/Nav.astro';
import Foot from '../../components/widget/Foot.astro';
import BlogPostPreview from '../../components/BlogPostPreview.astro';

const { id } = Astro.params;

let title = '';
let description = 'Please cite the source when reprinting. Due to a busy work schedule, if you require internationalization, please submit your request.';
let permalink = 'https://github.com/';

try {
    const baseUrl = new URL('/', Astro.request.url);
    const response = await fetch(`${baseUrl}api/v1/nav/${id}`);
    if (response.ok) {
        const data = await response.json();
        title = data.page_title
        description = data.page_description
        // console.log("duansg"+ data)
    } else {
        console.error('Failed to fetch nav items:', response.status);
    }
} catch (error) {
    console.error('Error fetching nav items:', error);
}


let allPosts = await Astro.glob('/src/pages/posts/*.md');

try {
    const baseUrl = new URL('/', Astro.request.url);
    const response = await fetch(`${baseUrl}api/v1/posts`);
    if (response.ok) {
        const json = await response.json();
        // allPosts = (json.data?.posts || []).map(p => p.content);
        allPosts = (json.data?.posts || []).map(p => ({
            frontmatter: {
                title: p.title,
                description: p.excerpt,
                cover: p.featured_img,
                publishDate: p.published_at,
            },
            id: p.id,
            url: `${p.slug}`,
            content: p.content,
        }));
    } else {
        console.error('Failed to fetch nav items:', response.status);
    }
} catch (error) {
    console.error('Error fetching nav items:', error);
}
allPosts = allPosts.sort((a, b) => new Date(b.frontmatter.publishDate).valueOf() - new Date(a.frontmatter.publishDate).valueOf());
---

<html lang="en">
<head>
    <BaseHead {title} {description} {permalink}/>
</head>

<body>
<Nav/>
<div class="wrapper">
    <main class="content">
        <section class="intro">
            <h1 class="latest"> {title} </h1>
            <p>{description} <a href="https://github.com/">
                <button class="btn-rocket link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                         class="bi bi-github" viewBox="0 0 16 16">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    Github
                </button>
            </a></p>
            <p>Read documentation here <a href="https://astronot.axcora.com/cms/">
                <button class="btn-astronot link">Documentation</button>
            </a></p>
        </section>
        <section aria-label="Blog post list" class="cards">
            {allPosts.map((p) =>
                    <BlogPostPreview post={p}/>)}
        </section>
    </main>
</div>
<Foot/>

<style>
    /* 为 carde div 添加渐变色背景 */
    .carde {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        color: white;
        padding: 2rem;
        margin: 1rem 0;
    }

    /* 卡片头部布局 */
    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .card-title-section {
        flex: 1;
        min-width: 200px;
    }

    .card-image-section {
        flex-shrink: 0;
    }

    /* 图片样式优化 */
    .astronot-image {
        width: 150px;
        height: 150px;
        object-fit: cover;
        border-radius: 12px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .astronot-image:hover {
        transform: scale(1.05) rotate(2deg);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
    }

    /* 确保内容文字可读性 */
    .carde h3 {
        color: white !important;
        font-weight: 600;
    }

    .carde p {
        color: rgba(255, 255, 255, 0.95) !important;
        line-height: 1.6;
    }

    /* 链接样式调整 */
    .carde .link {
        color: #fff !important;
        text-decoration: underline;
        font-weight: 500;
    }

    .carde .link:hover {
        color: #f0f0f0 !important;
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
    }

    /* 代码块样式调整 */
    .carde pre {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 1rem;
        color: white !important;
    }

    .carde code {
        background: rgba(255, 255, 255, 0.15) !important;
        color: white !important;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
        .carde {
            padding: 1.5rem;
            margin: 0.5rem;
        }

        .card-header {
            flex-direction: column;
            text-align: center;
            gap: 1.5rem;
        }

        .astronot-image {
            width: 120px;
            height: 120px;
        }

        .card-title-section {
            min-width: auto;
        }
    }
</style>